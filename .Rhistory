metagenome_df$V1 <- as.character(metagenome_df$V1)
colnames(metagenome_df) <- c("names", "counts")
samples <- c("S17463", "S17464")
likely_ancient <- list()
for (i in 1:length(samples)){
likely_ancient[[i]] <- read.table(paste(samples[i], ".likely_ancient", sep=''), header = F)
}
ancient <- bind_rows(likely_ancient, .id = "column_label")
likely_ancient <- list()
for (i in 1:length(samples)){
likely_ancient[[i]] <- read.table(paste(samples[i], ".likely_ancient", sep=''), header = F, stringsAsFactors = F)
}
ancient <- bind_rows(likely_ancient, .id = "column_label")
metagenome_df <- metagenome_df %>% mutate(anc = ifelse(names %in% ancient$V1, "Y", "N")) %>% separate(names, c("S", "Meta", "sort", "filter", "type1", "type2")) %>%
select(S, type1, type2, counts, anc) %>% unite("align", type1:type2, sep = "_") %>% mutate()
metagenome_sub <- metagenome_df %>% filter(align != "NA_NA", S %in% samples) %>% arrange(desc(anc))
new_order <- unique(metagenome_sub$align)
metagenome_sub$align <- factor(metagenome_sub$align, levels=new_order)
metagenome_byanc <- metagenome_sub %>% group_by(S, anc) %>% summarise(sum = sum(counts))
library(ggplot2)
gg_color_hue <- function(n) {
hues = seq(15, 375, length = n + 1)
hcl(h = hues, l = 65, c = 100)[1:n]
}
bp<- ggplot(metagenome_sub, aes(x="", y=counts, fill=align, alpha=anc))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.35, 1)) +
theme_minimal() + coord_polar("y", start = 0) +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + theme(legend.position = "none") + facet_grid(facets=. ~ S)
bp
metagenome_onlyanc <- metagenome_sub %>% filter(anc == "Y")
bp<- ggplot(metagenome_onlyanc, aes(x=S, y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill")
bp
bp<- ggplot(metagenome_byanc, aes(x=S, y=sum, fill=anc))+
geom_bar(width = 1, stat = "identity", position = "fill")
bp
#Get broad level names and counts to make pie charts
master_names <- read.table("master_names")
master_counts <- read.table("master_counts")
master_df <- data.frame(master_names, master_counts)
colnames(master_df) <- c("names", "counts")
master <- master_df %>% separate(names, c("S", "align", "filter", "bam")) %>% select(S, align, counts) %>% mutate(anc = ifelse(align == "coral" | (align == "meta" & S == "S17463"), "Y", "N")) %>%
arrange(anc)
new_order <- unique(master$align)
master$align <- factor(master$align, levels=new_order)
just1 <- master %>% filter(S == "S17463")
justanc <- just1 %>% filter(anc == "Y")
notanc <- just1 %>% filter(anc == "N", align %in% c("a", "b", "c", "d"))
master_pie<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_pie
master_pie<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
pal_diverse <- list(
"zoox1" = "#16BAC5", #bluegreen
"zoox2" = "#274690", #darkcornflowerblue
"zoox3" = "#5FBFF9", #mayablue
"zoox4" = "#81F499", #lightgreen
"cca" = "#DAD4EF", #languidlav
"redalg" = "#7B506F", #lavender
"meta" = "#BDC696", #sage
"coral" = "#EF8275" #salmon
)
nice_colors <- list(
"lavender" = "#7B506F",
"rubyred" = "#A20021"
)
master_pie<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_pie
S17463<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
S17463
S17463_anc<- ggplot(data = justanc, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(c(pal_diverse$meta, pal_diverse$coral), use.names = FALSE))
S17463_anc
S17463_noanc<- ggplot(data = notanc, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse[c("zoox1", "zoox2", "zoox3", "zoox4")], use.names = FALSE))
S17463_noanc
master_pie<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.35, 1)) +
theme_minimal() + coord_polar("y", start = 0) +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + theme(legend.position = "none") + facet_grid(facets=. ~ S)
master_pie
bp<- ggplot(metagenome_sub, aes(x="", y=counts, fill=align, alpha=anc))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.35, 1)) +
theme_minimal() + coord_polar("y", start = 0) +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + theme(legend.position = "none") + facet_grid(facets=. ~ S)
bp
metagenome_df <- metagenome_df %>% mutate(anc = ifelse(names %in% ancient$V1, "Y", "N")) %>% separate(names, c("S", "Meta", "sort", "filter", "type1", "type2")) %>%
select(S, type1, type2, counts, anc) %>% unite("align", type1:type2, sep = "_") %>% mutate()
metagenome_sub <- metagenome_df %>% filter(align != "NA_NA", S %in% samples) %>% arrange(desc(anc))
new_order <- unique(metagenome_sub$align)
metagenome_sub$align <- factor(metagenome_sub$align, levels=new_order)
metagenome_byanc <- metagenome_sub %>% group_by(S, anc) %>% summarise(sum = sum(counts))
library(ggplot2)
gg_color_hue <- function(n) {
hues = seq(15, 375, length = n + 1)
hcl(h = hues, l = 65, c = 100)[1:n]
}
bp<- ggplot(metagenome_sub, aes(x="", y=counts, fill=align, alpha=anc))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.35, 1)) +
theme_minimal() + coord_polar("y", start = 0) +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + theme(legend.position = "none") + facet_grid(facets=. ~ S)
bp
metagenome_onlyanc <- metagenome_sub %>% filter(anc == "Y")
bp<- ggplot(metagenome_onlyanc, aes(x=S, y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill")
bp
masterbar_sbs <- master %>% filter(anc == "Y") %>% ggplot(aes(x=S, y=counts, fill=align)) +
geom_bar(width = 1, stat = "identity", position = "fill")
masterbar_sbs
new_order <- unique(master$align)
master$align <- factor(master$align, levels=new_order)
just1 <- master %>% filter(S == "S17465")
justanc <- just1 %>% filter(anc == "Y")
notanc <- just1 %>% filter(anc == "N", align %in% c("a", "b", "c", "d"))
master_bar<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_bar
just1 <- master %>% filter(S == "S17464")
justanc <- just1 %>% filter(anc == "Y")
notanc <- just1 %>% filter(anc == "N", align %in% c("a", "b", "c", "d"))
master_bar<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_bar
new_order <- unique(master$align)
master$align <- factor(master$align, levels=new_order)
just1 <- master %>% filter(S == "S17466")
justanc <- just1 %>% filter(anc == "Y")
notanc <- just1 %>% filter(anc == "N", align %in% c("a", "b", "c", "d"))
master_bar<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_bar
all <- master %>% filter(anc == "Y")
master_bar<- ggplot(data = all, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_bar
master_bar<- ggplot(data = all, aes(x=S, y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_bar
head(all)
head(just1)
bp<- ggplot(metagenome_sub, aes(x="", y=counts, fill=align, alpha=anc))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.35, 1)) +
theme_minimal() + coord_polar("y", start = 0) +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + theme(legend.position = "none") + facet_grid(facets=. ~ S)
bp
bp<- ggplot(metagenome_sub, aes(x="", y=counts, fill=align, alpha=anc))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.35, 1)) +
theme_minimal() + #coord_polar("y", start = 0) +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + theme(legend.position = "none") + facet_grid(facets=. ~ S)
bp
samples <- c("S17463", "S17464", "S17465", "S17466")
likely_ancient <- list()
for (i in 1:length(samples)){
likely_ancient[[i]] <- read.table(paste(samples[i], ".likely_ancient", sep=''), header = F, stringsAsFactors = F)
}
ancient <- bind_rows(likely_ancient, .id = "column_label")
samples <- c("S17463", "S17464")
likely_ancient <- list()
for (i in 1:length(samples)){
likely_ancient[[i]] <- read.table(paste(samples[i], ".likely_ancient", sep=''), header = F, stringsAsFactors = F)
}
ancient <- bind_rows(likely_ancient, .id = "column_label")
metagenome_df <- metagenome_df %>% mutate(anc = ifelse(names %in% ancient$V1, "Y", "N")) %>% separate(names, c("S", "Meta", "sort", "filter", "type1", "type2")) %>%
select(S, type1, type2, counts, anc) %>% unite("align", type1:type2, sep = "_") %>% mutate()
metagenome_sub <- metagenome_df %>% filter(align != "NA_NA", S %in% samples) %>% arrange(desc(anc))
new_order <- unique(metagenome_sub$align)
metagenome_sub$align <- factor(metagenome_sub$align, levels=new_order)
metagenome_byanc <- metagenome_sub %>% group_by(S, anc) %>% summarise(sum = sum(counts))
library(ggplot2)
gg_color_hue <- function(n) {
hues = seq(15, 375, length = n + 1)
hcl(h = hues, l = 65, c = 100)[1:n]
}
bp<- ggplot(metagenome_sub, aes(x="", y=counts, fill=align, alpha=anc))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.35, 1)) +
theme_minimal() + #coord_polar("y", start = 0) +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + theme(legend.position = "none") + facet_grid(facets=. ~ S)
bp
metagenome_onlyanc <- metagenome_sub %>% filter(anc == "Y")
bp<- ggplot(metagenome_onlyanc, aes(x=S, y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill")
bp
#Get broad level names and counts to make pie charts
master_names <- read.table("master_names")
master_counts <- read.table("master_counts")
master_df <- data.frame(master_names, master_counts)
colnames(master_df) <- c("names", "counts")
master <- master_df %>% separate(names, c("S", "align", "filter", "bam")) %>% select(S, align, counts) %>% mutate(anc = ifelse(align == "coral" | (align == "meta" & S == "S17463"), "Y", "N")) %>%
arrange(anc)
new_order <- unique(master$align)
master$align <- factor(master$align, levels=new_order)
just1 <- master %>% filter(S == "S17466")
all <- master %>% filter(anc == "Y")
justanc <- just1 %>% filter(anc == "Y")
notanc <- just1 %>% filter(anc == "N", align %in% c("a", "b", "c", "d"))
master_bar<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_bar
master_bar<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = .5, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_bar
just1 <- master %>% filter(S == "S17463")
all <- master %>% filter(anc == "Y")
justanc <- just1 %>% filter(anc == "Y")
notanc <- just1 %>% filter(anc == "N", align %in% c("a", "b", "c", "d"))
master_bar<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = .5, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_bar
just1 <- master %>% filter(S == "S17464")
all <- master %>% filter(anc == "Y")
justanc <- just1 %>% filter(anc == "Y")
notanc <- just1 %>% filter(anc == "N", align %in% c("a", "b", "c", "d"))
master_bar<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = .5, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_bar
just1 <- master %>% filter(S == "S17465")
all <- master %>% filter(anc == "Y")
justanc <- just1 %>% filter(anc == "Y")
notanc <- just1 %>% filter(anc == "N", align %in% c("a", "b", "c", "d"))
master_bar<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = .5, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_bar
just1 <- master %>% filter(S == "S17466")
all <- master %>% filter(anc == "Y")
justanc <- just1 %>% filter(anc == "Y")
notanc <- just1 %>% filter(anc == "N", align %in% c("a", "b", "c", "d"))
master_bar<- ggplot(data = just1, aes(x="", y=counts, fill=align))+
geom_bar(width = .5, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.45, 1)) +
#geom_bar(data = metagenome_byanc, aes(x="", y=sum)) +
theme_minimal() +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + facet_grid(facets=. ~ S) + scale_fill_manual(values=unlist(pal_diverse, use.names = FALSE))
master_bar
metagenome_names <- read.table("filtered20files")
metagenome_counts <- read.table("filtered20counts")
metagenome_df <- data.frame(metagenome_names, metagenome_counts)
metagenome_df$V1 <- as.character(metagenome_df$V1)
colnames(metagenome_df) <- c("names", "counts")
samples <- c("S17463", "S17464")
likely_ancient <- list()
for (i in 1:length(samples)){
likely_ancient[[i]] <- read.table(paste(samples[i], ".likely_ancient", sep=''), header = F, stringsAsFactors = F)
}
ancient <- bind_rows(likely_ancient, .id = "column_label")
metagenome_df <- metagenome_df %>% mutate(anc = ifelse(names %in% ancient$V1, "Y", "N")) %>% separate(names, c("S", "Meta", "sort", "filter", "type1", "type2")) %>%
select(S, type1, type2, counts, anc) %>% unite("align", type1:type2, sep = "_") %>% mutate()
metagenome_sub <- metagenome_df %>% filter(align != "NA_NA", S %in% samples) %>% arrange(desc(anc))
new_order <- unique(metagenome_sub$align)
metagenome_sub$align <- factor(metagenome_sub$align, levels=new_order)
metagenome_byanc <- metagenome_sub %>% group_by(S, anc) %>% summarise(sum = sum(counts))
library(ggplot2)
gg_color_hue <- function(n) {
hues = seq(15, 375, length = n + 1)
hcl(h = hues, l = 65, c = 100)[1:n]
}
bp<- ggplot(metagenome_sub, aes(x="", y=counts, fill=align, alpha=anc))+
geom_bar(width = 1, stat = "identity", position = "fill") + scale_alpha_discrete(range = c(0.35, 1)) +
theme_minimal() + #coord_polar("y", start = 0) +
theme(
axis.title.x = element_blank(),
axis.title.y = element_blank(),
panel.border = element_blank(),
panel.grid=element_blank(),
axis.ticks = element_blank(),
axis.text.x = element_blank(),
plot.title=element_text(size=14, face="bold")
) + theme(legend.position = "none") + facet_grid(facets=. ~ S)
bp
head(metagenome_df)
head(metagenome_byanc)
